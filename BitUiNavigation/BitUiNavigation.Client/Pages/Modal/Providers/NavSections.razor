@using BitUiNavigation.Client.Services
@inherits TimeWarpStateComponent
@foreach (var section in NavSectionDetails)
{

    <BitText Typography="@BitTypography.Subtitle1">@(section.Title.ToUpper())</BitText>
    <BitNav 
            Mode="BitNavMode.Automatic"
            Items="@(section.CustomNavItems)"
            Match="BitNavMatch.Wildcard"
            FitWidth
            Style="margin:0 1rem"
            Classes="NavStyles"
            NameSelectors="@(new BitNavNameSelectors<CustomNavItem>
            {
                Text = { Name = nameof(CustomNavItem.Text) },
                Url = { Name = nameof(CustomNavItem.Url) }
            })">
    <ItemTemplate Context="item">
        <div class="nav-custom-item">
            <BitStack Horizontal VerticalAlign="BitAlignment.Center" Style="width:100%; gap:.5rem;">
                <!-- Left group -->
                <BitStack Horizontal VerticalAlign="BitAlignment.Center"
                          Style="flex:1 1 auto; min-width:0; gap:.5rem;">
                    <BitIcon IconName="@item.IconName" />
                    <BitText Style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
                        @item.Text
                    </BitText>
                </BitStack>

                    <!-- Right endcap: fixed width to prevent width changes -->
                    <div style="width:20px; display:flex; justify-content:flex-end;">
                    @if (!string.IsNullOrEmpty(item.ValidationIconName))
                        {
                            <BitIcon IconName="@item.ValidationIconName" Color="@BitColor.Error" />
                        }
                        else
                        {
                            <!-- invisible placeholder keeps width stable -->
                            <span style="width:16px; height:16px; display:inline-block; opacity:0;"></span>
                        }
                    </div>
                </BitStack>
            </div>
        </ItemTemplate>

    </BitNav>
}

@code {
    [Parameter, EditorRequired] public List<NavSectionDetail> NavSectionDetails { get; set; }
    private ModalHostState ModalHostState => GetState<ModalHostState>();
    static BitNavClassStyles NavStyles => new()
    {
        SelectedItemContainer = "nav-selected-item-container",
        ItemContainer = "nav-item-container",
        Item = "nav-item",
        SelectedItem = "nav-selected-item",
    };
}
